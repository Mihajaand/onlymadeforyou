<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cindy's Birthday üéÇ</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&family=Pacifico&family=Dancing+Script:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      #mainTitle {
        font-size: 32px;
        font-family: 'Pixelify Sans', sans-serif;
        margin-bottom: 8px;
      }

      #subTitle {
        font-size: 18px;
        font-family: 'Pixelify Sans', sans-serif;
        color: #555;
      }

      /* 3D Card Styles */
      .card-wrapper {
        position: fixed;
        top: 50%;
        left: 20%;
        transform: translate(-50%, -50%);
        perspective: 1500px;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      .card-wrapper.show {
        opacity: 1;
        pointer-events: auto;
      }

      .card-3d {
        width: 400px;
        height: 280px;
        position: relative;
        transform-style: preserve-3d;
        animation: cardFly 3s ease-in-out forwards;
      }

      @keyframes cardFly {
        0% {
          transform: translateZ(-800px) translateY(-400px) rotateY(-180deg) rotateX(45deg);
          opacity: 0;
        }
        50% {
          transform: translateZ(100px) translateY(50px) rotateY(360deg) rotateX(-10deg);
        }
        100% {
          transform: translateZ(0) translateY(0) rotateY(0deg) rotateX(0deg);
          opacity: 1;
        }
      }

      .card-envelope {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #89c4f4 0%, #b8e0ff 100%);
        border-radius: 15px;
        position: absolute;
        transform-style: preserve-3d;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 3px solid #6ba3d1;
      }

      .envelope-flap {
        display: none;
        width: 100%;
        height: 50%;
        background: linear-gradient(135deg, #6ba3d1 0%, #89c4f4 100%);
        position: absolute;
        top: 0;
        border-radius: 15px 15px 0 0;
        transform-origin: top;
        animation: openEnvelope 1.5s ease-in-out 3s forwards;
        border: 3px solid #5a92c0;
        border-bottom: none;
      }

      @keyframes openEnvelope {
        0% { transform: rotateX(0deg); }
        100% { transform: rotateX(-180deg); }
      }

      .card-inner {
        width: 100%;
        height: 100%;
        border: 1px dotted white;
        background: linear-gradient(135deg, #ffb3d9 0%, #ffc9e3 50%, #ffe5f0 100%);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) translateZ(10px);
        border-radius: 12px;
        padding: 25px;
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.5), 0 5px 15px rgba(0, 0, 0, 0.2);
        animation: cardReveal 1s ease-in-out 4.5s both;
        opacity: 0;
        border: 2px solid #ff91c7;
      }

      @keyframes cardReveal {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) translateZ(10px) scale(0.8);
        }
        100% {
          opacity: 1;
          transform: translate(-50%, -50%) translateZ(10px) scale(1);
        }
      }

      .card-content {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        text-align: center;
      }

      .card-title {
        font-family: 'Pacifico', cursive;
        font-size: 32px;
        color: #e91e63;
        text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
        margin-bottom: 10px;
      }

      .card-message {
        font-family: 'Dancing Script', cursive;
        font-size: 18px;
        border: 1px dashed #e91e63;
        background-color: white;
        color: #c2185b;
        line-height: 1.6;
        max-width: 320px;
        margin-top: -100px;
        z-index: 999999;
        position: relative;
        padding-top: 60px;
      }

      .profile-pic {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #e91e63;
        object-fit: cover;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .sparkles {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      .sparkle {
        position: absolute;
        width: 8px;
        height: 8px;
        background: radial-gradient(circle, #fff, #ffeb3b);
        border-radius: 50%;
        animation: sparkleFloat 2s ease-in-out infinite;
      }

      @keyframes sparkleFloat {
        0%, 100% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        50% {
          transform: translateY(-20px) scale(1.5);
          opacity: 0.5;
        }
      }

      .heart {
        position: absolute;
        color: #ff6b9d;
        font-size: 20px;
        animation: heartFloat 3s ease-in-out infinite;
      }

      @keyframes heartFloat {
        0%, 100% {
          transform: translateY(0) rotate(0deg);
          opacity: 0.8;
        }
        50% {
          transform: translateY(-15px) rotate(10deg);
          opacity: 1;
        }
      }

      .close-card {
        position: absolute;
        top: -15px;
        right: -15px;
        width: 35px;
        height: 35px;
        background: linear-gradient(135deg, #ff6b9d, #c44569);
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-card:hover {
        transform: scale(1.1) rotate(90deg);
        background: linear-gradient(135deg, #c44569, #a83256);
      }

      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background: #ff6b9d;
        position: absolute;
        animation: confettiFall 3s linear infinite;
      }

      @keyframes confettiFall {
        0% {
          transform: translateY(-100vh) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* Balloons and Fireworks on the right */
      .decorations-right {
        position: fixed;
        right: 10%;
        top: 50%;
        transform: translateY(-50%);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .decorations-right.show {
        opacity: 1;
      }

      .balloon {
        position: absolute;
        width: 60px;
        height: 75px;
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: balloonFloat 3s ease-in-out infinite;
      }

      .balloon::before {
        content: '';
        position: absolute;
        bottom: -30px;
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 80px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent);
      }

      .balloon::after {
        content: '';
        position: absolute;
        top: 10px;
        left: 15px;
        width: 15px;
        height: 20px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
      }

      .balloon1 {
        background: linear-gradient(135deg, #ff6b9d 0%, #ff8eb3 100%);
        top: -50px;
        left: -40px;
        animation-delay: 0s;
      }

      .balloon2 {
        background: linear-gradient(135deg, #89c4f4 0%, #a3d5ff 100%);
        top: 30px;
        left: 20px;
        animation-delay: 0.5s;
      }

      .balloon3 {
        background: linear-gradient(135deg, #ffeb3b 0%, #fff176 100%);
        top: -20px;
        left: 80px;
        animation-delay: 1s;
      }

      .balloon4 {
        background: linear-gradient(135deg, #c44569 0%, #d97799 100%);
        top: 60px;
        left: -20px;
        animation-delay: 1.5s;
      }

      .balloon5 {
        background: linear-gradient(135deg, #9C27B0 0%, #ba68c8 100%);
        top: 90px;
        left: 60px;
        animation-delay: 2s;
      }

      @keyframes balloonFloat {
        0%, 100% {
          transform: translateY(0) translateX(0);
        }
        50% {
          transform: translateY(-30px) translateX(10px);
        }
      }

      .firework {
        position: absolute;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        animation: fireworkExplode 1.5s ease-out infinite;
      }

      @keyframes fireworkExplode {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: scale(20);
          opacity: 0;
        }
      }

      .firework-container {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200px;
        height: 200px;
      }

      .spark {
        position: absolute;
        width: 3px;
        height: 3px;
        background: #ffeb3b;
        border-radius: 50%;
        box-shadow: 0 0 10px #ffeb3b;
        animation: sparkShoot 2s ease-out infinite;
      }

      @keyframes sparkShoot {
        0% {
          transform: translate(0, 0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translate(var(--tx), var(--ty)) scale(0);
          opacity: 0;
        }
      }

      .star-burst {
        position: absolute;
        font-size: 30px;
        animation: starBurst 2s ease-out infinite;
      }

      @keyframes starBurst {
        0% {
          transform: scale(0) rotate(0deg);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: scale(1.5) rotate(180deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <audio id="backgroundMusic" src="gone.mp3"></audio>
    <div class="container">
      <div id="birthdayText"></div>
      <div class="cake-container">
        <div class="cake" id="cake"></div>
      </div>
    </div>

    <!-- 3D Card -->
    <div class="card-wrapper" id="cardWrapper">
      <div class="card-3d">
        <div class="card-envelope">
          <div class="envelope-flap"></div>
          <div class="card-inner">
            <button class="close-card" onclick="closeCard()">‚úï</button>
            <div class="card-content">
              <div class="card-message">
                <img src="profile.jpeg" alt="Profile" class="profile-pic" />
                <p style="margin-bottom: 12px;">La distance m'emp√™che pas de t'apporter un g√¢teau yaourt-confiture, alors j'ai fait ce que je sais faire de mieux : j'ai cod√© ! üíª</p>
                <p style="margin-bottom: 12px;">Voici ton g√¢teau version Minecraft (comme ton jeu pr√©f√©r√©) avec ta chanson favorite en fond ! üéµ</p>
                <p style="margin-bottom: 12px;">J'esp√®re que √ßa te fera sourire ! ‚ú®üéÄ</p>
                <p style="font-size: 22px; color: #e91e63;">Passe une journ√©e extraordinaire ! üéâ <br>Joyeux Anniversaire! Cindyyy et gros bisous üéÇüéâ</p>
              </div>
              <div class="sparkles">
                <div class="sparkle" style="top: 10%; left: 15%; animation-delay: 0s;"></div>
                <div class="sparkle" style="top: 20%; left: 85%; animation-delay: 0.5s;"></div>
                <div class="sparkle" style="top: 70%; left: 10%; animation-delay: 1s;"></div>
                <div class="sparkle" style="top: 80%; left: 90%; animation-delay: 1.5s;"></div>
                <div class="heart" style="top: 5%; left: 50%;">üíï</div>
                <div class="heart" style="bottom: 5%; left: 20%; animation-delay: 1s;">üíù</div>
                <div class="heart" style="bottom: 10%; right: 20%; animation-delay: 0.5s;">üíñ</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Balloons and Fireworks on the right -->
    <div class="decorations-right" id="decorationsRight">
      <div class="balloon balloon1"></div>
      <div class="balloon balloon2"></div>
      <div class="balloon balloon3"></div>
      <div class="balloon balloon4"></div>
      <div class="balloon balloon5"></div>
      
      <div class="firework-container" id="fireworkContainer">
        <!-- Fireworks will be generated by JavaScript -->
      </div>
    </div>

    <script>
      // Read URL params
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name") || "Cindyyy";
      let candleCount = parseInt(params.get("candles")) || 4;
      candleCount = Math.min(Math.max(candleCount, 1), 30);

      const birthdayText = document.getElementById("birthdayText");
      birthdayText.innerHTML = `
        <div id="mainTitle">Happy Birthday, ${name}!</div>
        <div id="subTitle" style="cursor: pointer;">Click here to blow out the candles and make your wish come true! üéÇ</div>
      `;

      const cake = document.getElementById("cake");

      const colors = [
        "green-candle",
        "purple-candle",
        "blue-candle",
        "yellow-candle",
      ];
      const CAKE_VISUAL_WIDTH = 35;

      function createCandles(count) {
        cake.innerHTML = "";
        const CANDLE_VISUAL_WIDTH = 2;
        const availableWidth = CAKE_VISUAL_WIDTH;
        const candlesPerRow = 6;
        const rowCount = Math.ceil(count / candlesPerRow);
        const shiftAmount = 4;

        for (let i = 0; i < count; i++) {
          const candle = document.createElement("div");
          candle.classList.add("candle");
          const colorClass = colors[Math.floor(Math.random() * colors.length)];
          candle.classList.add(colorClass);

          const row = Math.floor(i / candlesPerRow);
          const col = i % candlesPerRow;
          const totalCandlesInRow = Math.min(
            candlesPerRow,
            count - row * candlesPerRow
          );
          const rowSpacing = availableWidth / (totalCandlesInRow + 1);

          const leftBase = rowSpacing * (col + 1) - CANDLE_VISUAL_WIDTH / 2 + 5;
          const rowShift = row % 2 === 0 ? 0 : shiftAmount;

          candle.style.position = "absolute";
          candle.style.top = `${10 + row * 3}px`;
          candle.style.left = `${leftBase - rowShift + 4}px`;

          cake.appendChild(candle);
        }
      }

      createCandles(candleCount);

      // Function to close card
      function closeCard() {
        document.getElementById("cardWrapper").classList.remove("show");
      }

      // Function to create fireworks
      function createFireworks() {
        const container = document.getElementById("fireworkContainer");
        const colors = ['#ff6b9d', '#89c4f4', '#ffeb3b', '#c44569', '#9C27B0', '#ff91c7'];
        
        setInterval(() => {
          // Create star burst
          const starBurst = document.createElement("div");
          starBurst.classList.add("star-burst");
          starBurst.textContent = ['‚ú®', '‚≠ê', 'üí´', 'üåü'][Math.floor(Math.random() * 4)];
          starBurst.style.left = Math.random() * 200 + 'px';
          starBurst.style.top = Math.random() * 200 + 'px';
          starBurst.style.animationDelay = Math.random() + 's';
          container.appendChild(starBurst);
          setTimeout(() => starBurst.remove(), 2000);

          // Create spark explosions
          for (let i = 0; i < 12; i++) {
            const spark = document.createElement("div");
            spark.classList.add("spark");
            const angle = (i / 12) * Math.PI * 2;
            const distance = 50 + Math.random() * 50;
            spark.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
            spark.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
            spark.style.left = 100 + Math.random() * 50 + 'px';
            spark.style.top = 100 + Math.random() * 50 + 'px';
            spark.style.background = colors[Math.floor(Math.random() * colors.length)];
            spark.style.boxShadow = `0 0 10px ${colors[Math.floor(Math.random() * colors.length)]}`;
            spark.style.animationDelay = Math.random() * 0.5 + 's';
            container.appendChild(spark);
            setTimeout(() => spark.remove(), 2000);
          }

          // Create circular firework bursts
          const firework = document.createElement("div");
          firework.classList.add("firework");
          firework.style.left = Math.random() * 150 + 'px';
          firework.style.top = Math.random() * 150 + 'px';
          firework.style.background = colors[Math.floor(Math.random() * colors.length)];
          firework.style.boxShadow = `0 0 20px ${colors[Math.floor(Math.random() * colors.length)]}`;
          firework.style.animationDelay = Math.random() * 0.3 + 's';
          container.appendChild(firework);
          setTimeout(() => firework.remove(), 1500);
        }, 800);
      }

      // Function to create confetti
      function createConfetti() {
        for (let i = 0; i < 50; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.classList.add("confetti");
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.background = ['#ff6b9d', '#c44569', '#89c4f4', '#ffeb3b', '#ff91c7'][Math.floor(Math.random() * 5)];
            confetti.style.animationDelay = Math.random() * 2 + "s";
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
          }, i * 50);
        }
      }

      // === Countdown Timer (2 seconds) ===
      let countdownStarted = false;
      const subTitle = document.getElementById("subTitle");

      subTitle.addEventListener("click", () => {
        if (countdownStarted) return;
        countdownStarted = true;

        let countdownValue = 2;
        subTitle.innerHTML = `<span id="countdown">${countdownValue}</span>`;

        const countdownInterval = setInterval(() => {
          countdownValue--;
          if (countdownValue >= 0) {
            document.getElementById("countdown").textContent = countdownValue;
          }

          if (countdownValue < 0) {
            clearInterval(countdownInterval);
            // Blow out candles
            const candles = document.querySelectorAll(".candle");
            candles.forEach((candle) => {
              const delay = Math.random() * 1000;
              setTimeout(() => {
                colors.forEach((color) => {
                  if (candle.classList.contains(color)) {
                    candle.classList.add("blown");
                  }
                });
              }, delay);
            });

            // Update subTitle after short delay and play music
              setTimeout(() => {
              subTitle.textContent = `Yayy! Wishing you the happiest birthday ever!! üéâ`;
              const music = document.getElementById("backgroundMusic");

              // Change background color when the music starts
              music.addEventListener('play', () => {
                document.body.style.backgroundColor = '#b3e5fc';
              });

              // Try to play the music (handle promise for some browsers)
              music.play().catch(() => {});

              // Show card and decorations after music starts
              setTimeout(() => {
                document.getElementById("cardWrapper").classList.add("show");
                document.getElementById("decorationsRight").classList.add("show");
                createConfetti();
                createFireworks();
              }, 800);
            }, 1200);
          }
        }, 1000);
      });
    </script>
  </body>
</html>